From 518c99795260b9ae67028847ec5d49ded030fde5 Mon Sep 17 00:00:00 2001
From: Xiao-Long Chen <chenxiaolong@cxl.epac.to>
Date: Mon, 26 Aug 2013 22:26:34 -0400
Subject: [PATCH] Add preferences for high touch sensitivity

Change-Id: I07d7f316d6d6e2679dbb12224ebfe0f3ac815150
---
 res/xml/display_settings.xml                  |  6 ++++++
 src/com/android/settings/DisplaySettings.java | 22 ++++++++++++++++++++++
 2 files changed, 28 insertions(+)

diff --git a/res/xml/display_settings.xml b/res/xml/display_settings.xml
index 8f246d0..3da142e 100644
--- a/res/xml/display_settings.xml
+++ b/res/xml/display_settings.xml
@@ -62,6 +62,12 @@
                 android:summary="@string/adaptive_backlight_summary"
                 android:defaultValue="true" />
 
+        <CheckBoxPreference
+            android:key="auto_adjust_touch"
+            android:title="@string/auto_adjust_touch_title"
+            android:summary="@string/auto_adjust_touch_summary"
+            android:defaultValue="false" />
+
         <!-- DeviceParts Device Specific Display settings -->
         <Preference
             android:key="advanced_display_settings"
diff --git a/src/com/android/settings/DisplaySettings.java b/src/com/android/settings/DisplaySettings.java
index d2cc84d..b1b7a5f 100644
--- a/src/com/android/settings/DisplaySettings.java
+++ b/src/com/android/settings/DisplaySettings.java
@@ -52,6 +52,8 @@ import com.android.settings.Utils;
 import org.cyanogenmod.hardware.AdaptiveBacklight;
 import org.cyanogenmod.hardware.TapToWake;
 
+import org.cyanogenmod.hardware.HighTouchSensitivity;
+
 import java.util.ArrayList;
 
 public class DisplaySettings extends SettingsPreferenceFragment implements
@@ -78,6 +80,8 @@ public class DisplaySettings extends Set;
     private static final String KEY_SCREEN_ANIMATION_STYLE = "screen_animation_style";
     private static final String KEY_SCREEN_COLOR_SETTINGS = "screencolor_settings";
 
+    private static final String KEY_AUTO_ADJUST_TOUCH = "auto_adjust_touch";
+
     private static final int DLG_GLOBAL_CHANGE_WARNING = 1;
 
     private CheckBoxPreference mAccelerometer;
@@ -99,6 +103,8 @@ public class DisplaySettings extends Set
     private CheckBoxPreference mAdaptiveBacklight;
     private CheckBoxPreference mTapToWake;
 
+    private CheckBoxPreference mHighTouchSensitivity;
+
     private ContentObserver mAccelerometerRotationObserver =
             new ContentObserver(new Handler()) {
         @Override
@@ -157,6 +163,11 @@ public class DisplaySettings extends Set
             mTapToWake = null;
         }
 
+        mHighTouchSensitivity = (CheckBoxPreference) findPreference(KEY_AUTO_ADJUST_TOUCH);
+        if (!isHighTouchSensitivitySupported()) {
+            getPreferenceScreen().removePreference(mHighTouchSensitivity);
+            mHighTouchSensitivity = null;
+        }
 
         Utils.updatePreferenceToSpecificActivityFromMetaDataOrRemove(getActivity(),
                 getPreferenceScreen(), KEY_ADVANCED_DISPLAY_SETTINGS);
@@ -484,5 +496,7 @@ public class DisplaySettings extends Set
         } else if (preference == mTapToWake) {
             return TapToWake.setEnabled(mTapToWake.isChecked());
+        } else if (preference == mHighTouchSensitivity) {
+            return HighTouchSensitivity.setEnabled(mHighTouchSensitivity.isChecked());
         }
         return super.onPreferenceTreeClick(preferenceScreen, preference);
     }
@@ -579,6 +593,15 @@ public class DisplaySettings extends Set
         } catch (NoClassDefFoundError e) {
             // Hardware abstraction framework not installed
             return false;
+        }
+    }
+
+    private static boolean isHighTouchSensitivitySupported() {
+        try {
+            return HighTouchSensitivity.isSupported();
+        } catch (NoClassDefFoundError e) {
+            // Hardware abstraction framework not installed
+            return false;
         }
     }
 }
-- 
1.8.4.2

